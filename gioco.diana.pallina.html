<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Pallina Saltatrice</title>
  </head>
  <body class="bg-gradient-to-b from-blue-400 to-blue-600 text-white overflow-hidden">
    <div class="fixed top-4 right-4 text-2xl font-bold bg-black bg-opacity-50 px-4 py-2 rounded">
      Punti: <span id="score">0</span>
    </div>
    <div class="fixed top-4 left-4 text-lg font-bold bg-black bg-opacity-50 px-4 py-2 rounded">
      Velocità: <span id="speed">1</span>x
    </div>
    <div id="game" class="h-screen w-screen relative">
      <div id="ground" class="absolute bottom-0 w-full h-20 bg-green-500"></div>
      <div
        id="player"
        class="absolute bottom-20 left-20 w-10 h-10 bg-yellow-400 rounded-full transition-all duration-500"
      ></div>
    </div>
    <div class="fixed bottom-4 left-1/2 transform -translate-x-1/2 text-center">
      <p class="text-lg">Premi SPAZIO per saltare!</p>
    </div>
    
    <!-- Game Over Modal -->
    <div id="gameOverModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden">
      <div class="bg-white text-black p-8 rounded-lg text-center">
        <h2 class="text-3xl font-bold mb-4">Game Over!</h2>
        <p class="text-xl mb-4">Punti finali: <span id="finalScore">0</span></p>
        <button id="restartBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded text-lg">
          Riprova
        </button>
      </div>
    </div>

    <script>
      let score = 0;
      let gameSpeed = 8; // Velocità iniziale molto più rapida
      let speedMultiplier = 1;
      let obstacles = [];
      let isJumping = false;
      let gameStartTime = Date.now();
      let lastSpeedIncrease = 0;
      let gameRunning = true;

      const player = document.getElementById('player');
      const scoreElement = document.getElementById('score');
      const speedElement = document.getElementById('speed');
      const gameArea = document.getElementById('game');
      const gameOverModal = document.getElementById('gameOverModal');
      const finalScoreElement = document.getElementById('finalScore');
      const restartBtn = document.getElementById('restartBtn');

      function createObstacle() {
        const obstacle = document.createElement('div');
        obstacle.className = 'absolute bottom-20 w-8 h-16 bg-red-500';
        obstacle.style.right = '-32px';
        gameArea.appendChild(obstacle);
        obstacles.push(obstacle);
      }

      function updateGame() {
        if (!gameRunning) return;

        const currentTime = Date.now();
        const elapsedTime = (currentTime - gameStartTime) / 1000;

        // Aumenta velocità ogni 20 secondi
        if (elapsedTime - lastSpeedIncrease >= 20) {
          speedMultiplier += 0.4; // Incremento più significativo
          gameSpeed = 8 * speedMultiplier; // Base velocità più alta
          speedElement.textContent = speedMultiplier.toFixed(1);
          lastSpeedIncrease = elapsedTime;
        }

        // Muovi ostacoli
        obstacles.forEach((obstacle, index) => {
          const currentRight = parseInt(obstacle.style.right) || 0;
          obstacle.style.right = (currentRight + gameSpeed) + 'px';

          // Controlla collisione
          const obstacleLeft = window.innerWidth - currentRight - 32;
          const playerLeft = 80;
          const playerBottom = isJumping ? 200 : 80;

          if (obstacleLeft < playerLeft + 40 && obstacleLeft > playerLeft - 32) {
            if (playerBottom < 136) {
              // Game Over
              gameOver();
              return;
            }
          }

          // Rimuovi ostacoli fuori schermo e aggiungi punti
          if (currentRight > window.innerWidth + 50) {
            obstacle.remove();
            obstacles.splice(index, 1);
            score++;
            scoreElement.textContent = score;
          }
        });

        // Crea nuovi ostacoli più frequentemente per compensare la velocità
        if (Math.random() < 0.006 * speedMultiplier) {
          createObstacle();
        }

        requestAnimationFrame(updateGame);
      }

      function jump() {
        if (!isJumping && gameRunning) {
          isJumping = true;
          player.style.bottom = '200px';
          setTimeout(() => {
            player.style.bottom = '80px';
            isJumping = false;
          }, 800);
        }
      }

      function gameOver() {
        gameRunning = false;
        finalScoreElement.textContent = score;
        gameOverModal.classList.remove('hidden');
      }

      function restartGame() {
        // Reset variabili
        score = 0;
        gameSpeed = 8; // Reset alla velocità iniziale rapida
        speedMultiplier = 1;
        obstacles = [];
        isJumping = false;
        gameStartTime = Date.now();
        lastSpeedIncrease = 0;
        gameRunning = true;

        // Reset UI
        scoreElement.textContent = '0';
        speedElement.textContent = '1';
        player.style.bottom = '80px';
        gameOverModal.classList.add('hidden');

        // Rimuovi tutti gli ostacoli
        const existingObstacles = gameArea.querySelectorAll('.absolute.bottom-20.bg-red-500');
        existingObstacles.forEach(obs => obs.remove());

        // Riavvia il gioco
        updateGame();
      }

      document.addEventListener('keydown', (event) => {
        if (event.code === 'Space') {
          event.preventDefault();
          jump();
        }
      });

      restartBtn.addEventListener('click', restartGame);

      // Inizia il gioco
      updateGame();
    </script>
  </body>
</html>